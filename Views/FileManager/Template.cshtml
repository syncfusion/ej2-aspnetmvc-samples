@using Syncfusion.EJ2
@using Syncfusion.EJ2.FileManager
@using EJ2MVCSampleBrowser.Models


@{
    string[] items = new string[] { "NewFolder", "Cut", "Copy", "Paste", "Delete", "Download", "Rename", "SortBy", "Refresh", "Selection", "View", "Details" };
}

@section ControlsSection {
    <div class="control-section">
        <div class="sample-container">
            @Html.EJS().FileManager("filemanager").AjaxSettings(
                new Syncfusion.EJ2.FileManager.FileManagerAjaxSettings
                {
                    Url = "https://ej2-aspcore-service.azurewebsites.net/api/FileManager/FileOperations",
                    UploadUrl = "https://ej2-aspcore-service.azurewebsites.net/api/FileManager/Upload",
                    DownloadUrl = "https://ej2-aspcore-service.azurewebsites.net/api/FileManager/Download",
                    GetImageUrl = "https://ej2-aspcore-service.azurewebsites.net/api/FileManager/GetImage"
                }
                ).CssClass("e-fm-template-sample").DetailsViewSettings(new Syncfusion.EJ2.FileManager.FileManagerDetailsViewSettings()
                {
                    Columns = new List<Syncfusion.EJ2.FileManager.FileManagerColumn>
                        {
                            new Syncfusion.EJ2.FileManager.FileManagerColumn
                            {
                                Field = "name",
                                HeaderText = "File Name",
                                Template = "${name}",
                            },
                            new Syncfusion.EJ2.FileManager.FileManagerColumn
                            {
                                Field = "size",
                                HeaderText = "File Size",
                                Template = "#sizeColumnTemplate"
                            },
                            new Syncfusion.EJ2.FileManager.FileManagerColumn
                            {
                                Field = "_fm_modified",
                                HeaderText = "Date Modified"
                            },
                            new Syncfusion.EJ2.FileManager.FileManagerColumn
                            {
                                HeaderText = "Actions",
                                Template = "#actionColumnTemplate"
                            }
                        }
                }).Height("600px").ToolbarSettings(new Syncfusion.EJ2.FileManager.FileManagerToolbarSettings()
                {
                    Items = items
                }).NavigationPaneTemplate("#navigationPaneTemplate").LargeIconsTemplate("#largeIconsTemplate").FileLoad("onFileLoad").MenuOpen("onMenuOpen").Render()
        </div>
    </div>
}


@section PreScripts {
    <script id="navigationPaneTemplate" type="text/x-template">
        <div class="e-nav-pane-node" style="display: inline-flex; align-items: center;">
            <span class="e-icons ${getIconsForFolders(name)}"></span>
            <span class="folder-name" style="margin-left: 8px;">${name}</span>
        </div>
    </script>

    <script id="largeIconsTemplate" type="text/x-template">
        ${getLargeIconsViewTemplateJSON(data)}
    </script>

    <script id="nameColumnTemplate" type="text/x-template">
        <div>${data.name}</div>
    </script>

    <script id="sizeColumnTemplate" type="text/x-template">
        <div>
            ${ validateSize(data) }
        </div>
    </script>

    <script id="actionColumnTemplate" type="text/x-template">
        <div class="action-ddb" data-name="${name}" data-isFile="${isFile}"></div>
    </script>

    <script>

        function validateSize(data) {
            if (!data || typeof data !== "object") return "-";
            if (!data.isFile) return "-";
            return formatSize(data.size);
        }
        function formatSize(bytes) {
            if (!bytes) return "0 B";
            const sizes = ["B", "KB", "MB", "GB", "TB"];
            let i = 0;
            while (bytes >= 1024 && i < sizes.length - 1) {
                bytes /= 1024;
                i++;
            }
            return `${bytes.toFixed(1)} ${sizes[i]}`;
        }

        function getIconsForFolders(name) {
            const icons = {
                Files: 'e-folder',
                Documents: 'e-file-document',
                Downloads: 'e-download',
                Pictures: 'e-thumbnail',
                Music: 'e-file-format',
                Videos: 'e-video',
                Employees: 'e-export-png',
                Food: 'e-export-png',
                Nature: 'e-export-png'
            };
            return icons[name] || 'e-folder';
        }

        function getBackgroundCss(item) {
            const named = {
                "Adam.png": "background-Adam",
                "Andrew.png": "background-Andrew",
                "Ellie.png": "background-Ellie",
                "Jameson.png": "background-Jameson",
                "John.png": "background-John",
                "Josie.png": "background-Josie",
                "Apple pie.png": "background-Applepie",
                "Bread.png": "background-Bread",
                "Doughnut.png": "background-Doughnut",
                "Nuggets.png": "background-Nuggets",
                "Sugar cookie.png": "background-Sugarcookie",
                "bird.jpg": "background-bird",
                "sea.jpg": "background-sea",
                "seaview.jpg": "background-seaview",
                "snow.jpg": "background-snow",
                "snowfall.jpg": "background-snowfall"
            };

            const extTypes = {
                jpg: "background-jpg",
                jpeg: "background-jpg",
                png: "background-png",
                pptx: "background-pptx",
                pdf: "background-pdf",
                mp4: "background-video",
                mp3: "background-audio",
                docx: "background-doc",
                txt: "background-txt",
                xlsx: "background-xlsx"
            };

            if (!item.isFile) return "file-icon background-folder";
            if (named[item.name]) return "file-icon " + named[item.name];

            const ext = (item.name.split('.').pop() || "").toLowerCase();
            return "file-icon " + (extTypes[ext] || "background-default");
        }

        function getFileIconCssClass(item) {
            if (!item.isFile) return "";
            const map = {
                jpg: "image",
                jpeg: "image",
                png: "image",
                gif: "image",
                mp3: "music",
                wav: "music",
                mp4: "video",
                avi: "video",
                doc: "doc",
                docx: "docx",
                ppt: "pptx",
                pptx: "pptx",
                xls: "xlsx",
                xlsx: "xlsx",
                txt: "txt",
                js: "js",
                css: "css",
                html: "html",
                exe: "exe",
                msi: "msi",
                php: "php",
                xml: "xml",
                zip: "zip",
                rar: "rar",
                pdf: "pdf"
            };
            const extension = (item.name.split('.').pop() || "").toLowerCase();
            return "e-list-icon e-fe-" + (map[extension] || "unknown");
        }

        function getLargeIconsViewTemplateJSON(item) {
            const name = item.name, isFile = item.isFile;
            const date = item.dateCreated ? new Date(item.dateCreated).toLocaleDateString("en-US", {
                year: 'numeric', month: 'long', day: 'numeric'
            }) : '';
            const iconClass = getFileIconCssClass(item);
            const bgClass = getBackgroundCss(item);
            const iconHtml = isFile ? `<div class="${iconClass}"></div>` : '';
            return `
                    <div class="custom-icon-card">
                        <div class="file-header">
                            <div class="left-info">
                                ${iconHtml}
                                <div class="file-name" title="${name}">${name}</div>
                            </div>
                            <div class="action-ddb" data-name="${name}" data-isFile="${isFile}"></div>
                        </div>
                        <div class="${bgClass}" title="${name}"></div>
                        <div class="file-formattedDate">Created on ${date}</div>
                    </div>`;
        }
    </script>

    <script>
        const actionItems = [
            { text: 'Open', iconCss: 'e-icons e-folder-open' },
            { text: 'Download', iconCss: 'e-icons e-download' },
            { text: 'Refresh', iconCss: 'e-icons e-refresh' },
            { text: 'Delete', iconCss: 'e-icons e-trash' }
        ];

        function onMenuOpen(args) {
            args.cancel = true;
        }

        function onFileLoad(args) {
            var moduleName = args.module;
            if (moduleName === "DetailsView" || moduleName === "LargeIconsView") {
                var element = args.element.querySelector('.action-ddb');
                if (element && !element.hasAttribute('data-ddb-initialized')) {
                    var fileObj = document.querySelector('#filemanager').ej2_instances[0];
                    wireDropDownButton(element, fileObj);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const fileObj = document.querySelector('#filemanager').ej2_instances[0];
            fileObj.fileLoad = function (args) {
                const validModules = ['DetailsView', 'LargeIconsView'];
                if (validModules.includes(args.module)) {
                    const actionBtn = args.element.querySelector('.action-ddb');
                    if (actionBtn && !actionBtn.hasAttribute('data-ddb-initialized')) {
                        wireDropDownButton(actionBtn, fileObj);
                    }
                }
            };

            function wireDropDownButton(el, fileObj) {
                const name = el.getAttribute('data-name');
                const isFile = el.getAttribute('data-isFile') === 'true';

                const items = isFile
                    ? actionItems.filter(i => i.text !== 'Open')
                    : actionItems;

                new ej.splitbuttons.DropDownButton({
                    items: items,
                    cssClass: 'e-caret-hide filemanager-dropdown-button',
                    select: function (args) {
                        const action = args.item.text;
                        switch (action) {
                            case 'Open': fileObj.openFile(name); break;
                            case 'Download': fileObj.downloadFiles([name]); break;
                            case 'Refresh': fileObj.refreshFiles(); break;
                            case 'Delete': fileObj.deleteFiles([name]); break;
                        }
                    },
                    iconCss: 'e-icons e-more-vertical-1'
                }).appendTo(el);

                el.setAttribute("data-ddb-initialized", "true");
            }
        });
    </script>
}

@section ActionDescription{
    <div id="action-description">
        <p>
            This sample showcases how to customize the Syncfusion File Manager's control with template support in the Navigation pane, Large icons and Details view.
        </p>
    </div>
}

@section Description{
    <div id="description">
        <p>
            The <code>NavigationPaneTemplate</code> renders the nodes with icons based on folder names, while the<code>LargeIconsTemplate</code> displays files with styled backgrounds and a action menu in each file/folder.
            The <code>DetailsViewSettings</code> template shows file information like name, size, and modified date in columns.
            File operations such as Open, Delete, Download, and Refresh are handled through a dropdown menu option showed in each item,
            and the <code>select</code> initiates each action to the corresponding File Manager methods (<code>OpenFile</code>,
            <code>DownloadFiles</code>, <code>DeleteFiles</code>, and <code>RefreshFiles</code>).
        </p>

        <p>
            <b>Note: </b>File Manager's upload functionality is restricted in the online demos for security reasons. If you need to test upload functionality, please install
            <a target="_blank" href="https://www.syncfusion.com/downloads" aria-label="Syncfusion Essential Studio">Syncfusion Essential Studio<sup>&reg;</sup> <span class="sr-only">opens in a new tab</span></a>on your machine and run the demo.
        </p>
    </div>
}

@section Meta{
    <meta name="description" content="This example demonstrates the Template in ASP.NET MVC File Manager control. Explore here for more details." />
}

@section Title{
    <title>ASP.NET MVC File Manager Template Example - Syncfusion Demos </title>
}
@section Header{
    <h1 class='sb-sample-text'>Example of Template in ASP.NET MVC File Manager Control</h1>
}

<style>

    .e-filemanager.e-fm-template-sample .e-list-icon {
        height: 20px !important;
        margin: 0 !important;
        width: 20px !important;
    }

    .e-dropdown-btn.filemanager-dropdown-button {
        border: none;
        margin-right: -6px;
        box-shadow: none;
        background: transparent;
    }

        .e-dropdown-btn.filemanager-dropdown-button:hover, .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover {
            background: #d4d4d4;
        }

    .fluent2-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent2-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .fluent-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .material3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .material3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .tailwind3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .tailwind3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .fluent2-highcontrast .e-dropdown-btn.filemanager-dropdown-button:hover, .fluent2-highcontrast .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .highcontrast .e-dropdown-btn.filemanager-dropdown-button:hover, .highcontrast .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover,
    .bootstrap5\.3-dark .e-dropdown-btn.filemanager-dropdown-button:hover, .bootstrap5\.3-dark .e-dropdown-btn.filemanager-dropdown-button.e-btn:hover {
        background: #3d3d3d;
    }

    .bootstrap5\.3 .e-dropdown-btn.filemanager-dropdown-button {
        color: #242424;
    }

    .e-filemanager.e-fm-template-sample .e-grid .e-gridheader .e-fe-grid-icon + .e-rowcell, .e-filemanager .e-grid .e-gridheader .e-fe-grid-icon + .e-headercell, .e-filemanager .e-grid .e-gridcontent .e-fe-grid-icon + .e-rowcell, .e-filemanager .e-grid .e-gridcontent .e-fe-grid-icon + .e-headercell {
        padding-left: 6px;
    }

    .e-fm-template-sample .e-nav-pane-node .e-icons {
        font-size: larger;
    }

    .e-fm-template-sample .custom-icon-card {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 10px;
        height: 100%;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
    }

    .e-fm-template-sample .file-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        margin-bottom: 10px;
    }

    .e-fm-template-sample .left-info {
        display: flex;
        align-items: center;
        gap: 8px;
        overflow: hidden;
        flex-shrink: 1;
        flex-grow: 1;
    }

    .e-fm-template-sample .file-name {
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 160px;
    }

    .e-fm-template-sample .file-formattedDate {
        font-size: 12px;
        margin-top: 8px;
        text-align: center;
        font-weight: 600;
    }

    .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item {
        height: 185px;
        width: 100px;
        margin: 8px 4px;
    }

        .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item .file-icon {
            width: 150px;
            height: 90px;
        }

        .e-filemanager.e-fm-template-sample.e-fe-mobile .e-large-icons .e-list-parent .e-list-item .file-name {
            max-width: 100px;
        }

    .e-filemanager.e-fm-template-sample .e-large-icons .e-list-item {
        height: 240px;
        width: 210px;
    }

    .e-filemanager.e-fm-template-sample .e-large-icons .e-list-parent .e-list-item .file-icon {
        width: 190px;
        height: 150px;
        background-repeat: no-repeat;
        background-position: center center;
        background-size: contain;
        margin-bottom: 10px;
    }

    /* Generic file type backgrounds */
    .background-folder     { background-image: url('@Url.Content("~/Content/filemanager/images/folders.svg")'); }
    .background-png        { background-image: url('@Url.Content("~/Content/filemanager/images/image-png.svg")'); }
    .background-pptx       { background-image: url('@Url.Content("~/Content/filemanager/images/pptx.png")'); }
    .background-jpg        { background-image: url('@Url.Content("~/Content/filemanager/images/image-jpg.svg")'); }
    .background-doc        { background-image: url('@Url.Content("~/Content/filemanager/images/docx.png")'); }
    .background-pdf        { background-image: url('@Url.Content("~/Content/filemanager/images/pdfphoto.png")'); }
    .background-txt        { background-image: url('@Url.Content("~/Content/filemanager/images/text.png")'); }
    .background-video      { background-image: url('@Url.Content("~/Content/filemanager/images/video.png")'); }
    .background-audio      { background-image: url('@Url.Content("~/Content/filemanager/images/music.png")'); }
    .background-xlsx       { background-image: url('@Url.Content("~/Content/filemanager/images/xlsx.png")'); }

    /* People images */
    .background-Adam       { background-image: url('@Url.Content("~/Content/filemanager/images/adam.png")'); }
    .background-Andrew     { background-image: url('@Url.Content("~/Content/filemanager/images/andrew.png")'); }
    .background-Ellie      { background-image: url('@Url.Content("~/Content/filemanager/images/ellie.png")'); }
    .background-Jameson    { background-image: url('@Url.Content("~/Content/filemanager/images/jameson.png")'); }
    .background-John       { background-image: url('@Url.Content("~/Content/filemanager/images/john.png")'); }
    .background-Josie      { background-image: url('@Url.Content("~/Content/filemanager/images/josie.png")'); }

    /* Food images */
    .background-Applepie   { background-image: url('@Url.Content("~/Content/filemanager/images/apple-pie.png")'); }
    .background-Bread      { background-image: url('@Url.Content("~/Content/filemanager/images/bread.png")'); }
    .background-Doughnut   { background-image: url('@Url.Content("~/Content/filemanager/images/doughnut.png")'); }
    .background-Nuggets    { background-image: url('@Url.Content("~/Content/filemanager/images/nuggets.png")'); }
    .background-Sugarcookie{ background-image: url('@Url.Content("~/Content/filemanager/images/sugar-cookie.png")'); }

    /* Nature images */
    .background-bird       { background-image: url('@Url.Content("~/Content/filemanager/images/bird.png")'); }
    .background-sea        { background-image: url('@Url.Content("~/Content/filemanager/images/sea.png")'); }
    .background-seaview    { background-image: url('@Url.Content("~/Content/filemanager/images/seaview.png")'); }
    .background-snow       { background-image: url('@Url.Content("~/Content/filemanager/images/snow.png")'); }
    .background-snowfall   { background-image: url('@Url.Content("~/Content/filemanager/images/snowfall.png")'); }
</style>